var e=Object.assign;import{d as a,r as l,i,j as t,t as n,p as r,a as o,o as s,c as d,b as f,w as c,k as g,h as u,l as m,f as v}from"./index.556b9852.js";var p=a({name:"SketchGif",setup:()=>{let a;const r=l({video:null,canvas:null,file:null,videoSrc:"",fileName:"",size:0,gifUrl:"",config:{frame:8,quality:10},loading:!1});let o;const s=i((()=>1e3/r.config.frame)),d=t(null),f=t(null),c=(e,a,l)=>{const i=(l=l||{}).blurRadius||2,t=l.lowThreshold||20,n=l.highThreshold||50,r=e.width||e.videoWidth,o=e.height||e.videoHeight;let s=r,d=o;r>400&&(s=400,d=Math.round(o*s/r));const f=a.getContext("2d");a.width=e.width=s,a.height=e.height=d,f.clearRect(0,0,s,d),f.drawImage(e,0,0,s,d);const c=f.getImageData(0,0,s,d),g=new jsfeat.matrix_t(s,d,jsfeat.U8C1_t);jsfeat.imgproc.grayscale(c.data,s,d,g);const u=2*(i+1);jsfeat.imgproc.gaussian_blur(g,g,u,0),jsfeat.imgproc.canny(g,g,t,n);const m=new Uint32Array(c.data.buffer);let v=g.cols*g.rows,p=0;for(;--v>=0;)p=255-g.data[v],m[v]=-16777216|p<<16|p<<8|p;f.putImageData(c,0,0)},g=()=>{let e=(new Date).getTime(),l=(new Date).getTime(),i=0;c(d.value,f.value),u(),a=setInterval((()=>{e=(new Date).getTime(),c(d.value,f.value),u(),l=(new Date).getTime(),i=l-e,console.log(s.value>i?s.value-i:0)}),s.value>i?s.value-i:0)},u=()=>{const e=new Image;e.src=f.value.toDataURL("image/png"),e.width=f.value.width,e.height=f.value.height,o.addFrame(e,{delay:1e3/r.config.frame})},m=()=>{o=new GIF({workers:4,quality:r.config.quality,workerScript:"https://xxliang1122.github.io/utils/dist/gif.worker.js"}),o.on("finished",(e=>{r.gifUrl=URL.createObjectURL(e),r.loading=!1,o=null}))};return e(e({},n(r)),{expectDelay:s,refVideoEle:d,refCanvasEle:f,fileChange:e=>{r.videoSrc=URL.createObjectURL(e.target.files[0]),r.fileName=e.target.files[0].name,r.size=Math.round(e.target.files[0].size/1024)},play:()=>{g()},ended:()=>{clearInterval(a);try{o.render()}catch(e){r.loading=!1,console.log(e)}},playVideo:()=>{r.videoSrc&&(m(),r.loading=!0,console.log(d),d.value.play())}})}});const h=v("data-v-82cb88b0");r("data-v-82cb88b0");const y={class:"wrapper"},b=f("header",null,"线稿 GIF 生成器",-1),w={class:"content"},U={ref:"refCanvasEle"},k={class:"controls"},j={class:"btn-group"},C=f("label",{class:"btn-upload",for:"file"},"选择视频",-1),I={key:0,class:"btn-transform"},D={class:"config"},V=f("span",null,"选择帧率：",-1),x=f("label",{for:"frame8"},"8帧",-1),R=f("label",{for:"frame16"},"16帧",-1),S=f("label",{for:"frame32"},"24帧",-1),T={key:0,class:"file-name"},_={key:1},E=f("p",{class:"tips"},"点击图片下载",-1);o();const L=h(((e,a,l,i,t,n)=>(s(),d("div",y,[b,f("div",w,[f("video",{ref:"refVideoEle",src:e.videoSrc,onPlay:a[1]||(a[1]=(...a)=>e.play&&e.play(...a)),onEnded:a[2]||(a[2]=(...a)=>e.ended&&e.ended(...a)),controls:"",muted:""},null,40,["src"]),f("canvas",U,null,512),f("div",k,[f("div",j,[C,f("input",{id:"file",type:"file",accept:"video/*",onChange:a[3]||(a[3]=(...a)=>e.fileChange&&e.fileChange(...a)),ref:"file"},null,544),e.loading?(s(),d("div",I,"正在生成...")):(s(),d("div",{key:1,class:"btn-transform",onClick:a[4]||(a[4]=(...a)=>e.playVideo&&e.playVideo(...a))},"开始"))]),f("div",D,[V,c(f("input",{id:"frame8",type:"radio",name:"frame",value:"8","onUpdate:modelValue":a[5]||(a[5]=a=>e.config.frame=a)},null,512),[[g,e.config.frame]]),x,c(f("input",{id:"frame16",type:"radio",name:"frame",value:"16","onUpdate:modelValue":a[6]||(a[6]=a=>e.config.frame=a)},null,512),[[g,e.config.frame]]),R,c(f("input",{id:"frame32",type:"radio",name:"frame",value:"24","onUpdate:modelValue":a[7]||(a[7]=a=>e.config.frame=a)},null,512),[[g,e.config.frame]]),S])]),e.fileName?(s(),d("p",T,"已选："+u(e.fileName)+"， 大小："+u(e.size)+"kb",1)):m("",!0),e.gifUrl&&!e.loading?(s(),d("div",_,[E,f("a",{href:e.gifUrl,target:"_blank"},[f("img",{class:"result-gif",src:e.gifUrl},null,8,["src"])],8,["href"])])):(s(),d("div",{key:2,class:["boy",{snoring:e.loading}]},null,2))])]))));p.render=L,p.__scopeId="data-v-82cb88b0";export default p;
