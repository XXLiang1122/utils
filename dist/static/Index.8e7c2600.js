var a=Object.assign;import{_ as e}from"./Wrapper.1c809b74.js";import{d as t,r as n,l,q as s,t as r,s as o,p as g,a as i,b as u,o as d,c,e as h,f as m,v as p,i as v,F as f,g as C,u as I,x as w,w as b}from"./index.7e8c325f.js";var M=(a,e)=>{const{data:t}=a,n=t.length;let l=0,s=0,r=0,o=0;for(let g=0;g<n;g+=4)l=+e.r+t[g],s=+e.g+t[g+1],r=+e.b+t[g+2],o=+e.a+t[g+3],t[g]=l<0?0:l>255?255:l,t[g+1]=s<0?0:s>255?255:s,t[g+2]=r<0?0:r>255?255:r,t[g+3]=o<0?0:o>255?255:o;return a},x=(a,e)=>{const{data:t}=a,n=t.length;let l=0,s=0,r=0;for(let o=0;o<n;o+=4){let[a,n,g]=U(t[o],t[o+1],t[o+2]);0===o&&console.log(a,n,g),a=+e.h+a/100,n=+e.s+n/100,g=+e.l+g/100,l=a<0?0:a>1?1:a,s=n<0?0:n>1?1:n,r=g<0?0:g>1?1:g;let[i,u,d]=y(l,s,r);t[o]=i,t[o+1]=u,t[o+2]=d}return a};function U(a,e,t){let n=a/255,l=e/255,s=t/255,r=Math.max(n,l,s),o=Math.min(n,l,s),g=(r+o)/2,i=(r+o)/2,u=(r+o)/2;if(r===o)g=0,i=0;else{let a=r-o;switch(i=u>.5?a/(2-r-o):a/(r+o),r){case n:g=(l-s)/a+(l<s?6:0);break;case l:g=(s-n)/a+2;break;case s:g=(n-l)/a+4}g/=6}return[Math.floor(100*g),Math.round(100*i),Math.round(100*u)]}function y(a,e,t){let n,l,s;if(0===e)n=t,l=t,s=t;else{const r=(a,e,t)=>(t<0&&(t+=1),t>1&&(t-=1),t<1/6?a+6*(e-a)*t:t<.5?e:t<2/3?a+(e-a)*(2/3-t)*6:a),o=t<.5?t*(1+e):t+e-t*e,g=2*t-o;n=r(g,o,a+1/3),l=r(g,o,a),s=r(g,o,a-1/3)}return[Math.round(255*n),Math.round(255*l),Math.round(255*s)]}const D=(a,e,t)=>{let n=e.width,l=e.height,s=e.data,r=a.data;for(let o=1;o<l-1;o+=1)for(let a=1;a<n-1;a+=1){for(let e=0;e<3;e+=1){let l=4*(o*n+a)+e;r[l]=t[0]*s[l-4*n-4]+t[1]*s[l-4*n]+t[2]*s[l-4*n+4]+t[3]*s[l-4]+t[4]*s[l]+t[5]*s[l+4]+t[6]*s[l+4*n-4]+t[7]*s[l+4*n]+t[8]*s[l+4*n+4]}r[4*(o*n+a)+3]=255}return a};var k=[a=>{const{data:e}=a,t=e.length;for(let n=0;n<t;n+=4){const a=(e[n]+e[n+1]+e[n+2])/3;e[n]=e[n+1]=e[n+2]=a}return a},a=>{const{data:e}=a,t=e.length;for(let n=0;n<t;n+=4){const a=(e[n]+e[n+1]+e[n+2])/3;e[n]=e[n+1]=e[n+2]=a>100?255:0}return a},a=>{const{data:e}=a,t=e.length;for(let n=0;n<t;n+=4)e[n]=255-e[n],e[n+1]=255-e[n+1],e[n+2]=255-e[n+2];return a},a=>{const{data:e}=a,t=e.length;for(let n=0;n<t;n+=4){const a=(Math.max(e[n],e[n+1],e[n+2])+Math.min(e[n],e[n+1],e[n+2]))/2;e[n]=e[n+1]=e[n+2]=a}return a},a=>{const{data:e}=a,t=e.length;for(let n=0;n<t;n+=4){const a=e[n],t=e[n+1],l=e[n+2],s=.393*a+.769*t+.189*l,r=.349*a+.686*t+.168*l,o=.272*a+.534*t+.131*l;e[n]=s<0?0:s>255?255:s,e[n+1]=r<0?0:r>255?255:r,e[n+2]=o<0?0:o>255?255:o}return a},a=>{const{data:e}=a,t=e.length;for(let n=0;n<t;n+=4){const a=e[n],t=e[n+1],l=e[n+2];e[n]=Math.round(Math.abs(t-l+t+a)*a/256),e[n+1]=Math.round(Math.abs(l-t+l+a)*a/256),e[n+2]=Math.round(Math.abs(l-t+l+a)*t/256)}return a},(a,e)=>{const t=e.createImageData(a);return D(t,a,[-1,-1,-1,-1,9,-1,-1,-1,-1])},(a,e)=>{const t=e.createImageData(a);return D(t,a,[-1,-1,-1,-1,8,-1,-1,-1,-1])}],X=t({name:"Filter",components:{Wrapper:e},setup:()=>{const e=n({r:0,g:0,b:0,a:0}),t=n({h:0,s:0,l:0}),g=n({width:600,height:480}),i={startMove:!1,startX:0,startY:0},u={width:0,height:0,originImgData:{}},d=n({imageUrl:"",imageName:"img",mineType:"image/png",scale:1,showPreviewImg:!1}),c=n({curIndex:0,list:["选择滤镜","灰度","黑白","反相","去色","怀旧","连环画","锐化（卷积）","边缘（卷积）"],methods:k}),h=l(),m=l();let p;const v=()=>new ImageData(new Uint8ClampedArray(u.originImgData.data),u.originImgData.width,u.originImgData.height),f=()=>{const a=new Image;a.onload=()=>{a.naturalWidth>1e4||a.naturalHeight>1e4?alert("图片太大了！"):(g.width=a.naturalWidth,g.height=a.naturalHeight,u.width=a.naturalWidth,u.height=a.naturalHeight,o((()=>{null==p||p.drawImage(a,0,0,u.width,u.height),u.originImgData=(null==p?void 0:p.getImageData(0,0,u.width,u.height))||{},C()})))},a.src=d.imageUrl},C=()=>{var a;d.scale=1,e.r=0,e.g=0,e.b=0,e.a=0,t.h=0,t.s=0,t.l=0,c.curIndex=0,null==(a=m.value)||a.scrollTo(4500,4600)};return s((()=>{p=h.value.getContext("2d"),C()})),a(a(a(a({},r(e)),r(t)),r(d)),{canvas:g,preset:c,refCanvas:h,refCanvasContainer:m,rgbaChange:()=>{if(!d.imageUrl)return;const{h:a,s:n,l:l}=t;let s=v();(+a||+n||+l)&&(s=x(s,t)),s=M(s,e),null==p||p.putImageData(s,0,0),c.curIndex=0},hslChange:()=>{if(!d.imageUrl)return;const{r:a,g:n,b:l,a:s}=e;let r=v();(+a||+n||+l||+s)&&(r=M(r,e)),r=x(r,t),null==p||p.putImageData(r,0,0),c.curIndex=0},imageChange:a=>{const e=a.target.files||[];if(0===e.length)return;const t=new FileReader;t.readAsDataURL(e[0]),t.onload=a=>{var e;d.imageUrl=null==(e=a.target)?void 0:e.result,f()},d.imageName=e[0].name,d.mineType=e[0].type},dragStart:a=>{i.startMove=!0,i.startX=a.screenX,i.startY=a.screenY},dragOver:a=>{var e;i.startMove&&(a.screenX===i.startX&&a.screenY===i.startY||(null==(e=m.value)||e.scrollBy(1*(i.startX-a.screenX),1*(i.startY-a.screenY)),i.startX=a.screenX,i.startY=a.screenY))},dragEnd:a=>{i.startMove=!1},downloadImage:()=>{const a=h.value.toDataURL(d.mineType),e=document.createElement("a");e.href=a,e.download=d.imageName,e.click()},resetStatus:()=>{d.imageUrl&&(null==p||p.putImageData(v(),0,0),C())},selectPreset:a=>{if(C(),c.curIndex=a.target.options.selectedIndex,!d.imageUrl)return;let e=v();c.curIndex>0&&(e=c.methods[c.curIndex-1](e,p)),null==p||p.putImageData(e,0,0)},showImage:()=>{d.imageUrl&&(d.showPreviewImg=!0)}})}});const Y=b("data-v-486cb5f6");g("data-v-486cb5f6");const V={class:"btn-group"},P=h("label",{class:"btn-upload button-l",for:"file"},"选择图片",-1),S={class:"contols-group"},W={class:"controls"},E=h("span",null,"R 红色 ",-1),H={class:"value"},O=h("span",null,"G 绿色 ",-1),R={class:"value"},T=h("span",null,"B 蓝色 ",-1),_={class:"value"},j=h("span",null,"A 透明 ",-1),A={class:"value"},F={class:"controls"},L=h("span",null,"H 色相 ",-1),N={class:"value"},B=h("span",null,"S 饱和 ",-1),$={class:"value"},q=h("span",null,"L 亮度 ",-1),G={class:"value"},z={class:"preset"},J=h("label",{for:"preset"},"预设：",-1),K={class:"board"},Q={class:"right"},Z={class:"scale-control"};i();const aa=Y(((a,e,t,n,l,s)=>{const r=u("Wrapper");return d(),c(f,null,[h(r,{title:"图片处理",width:"1200"},{default:Y((()=>[h("div",V,[P,h("input",{id:"file",type:"file",accept:"image/*",onChange:e[1]||(e[1]=(...e)=>a.imageChange&&a.imageChange(...e))},null,32),h("div",{class:"button-l",onClick:e[2]||(e[2]=(...e)=>a.downloadImage&&a.downloadImage(...e))},"下载图片"),h("div",{class:"button-l",onClick:e[3]||(e[3]=(...e)=>a.resetStatus&&a.resetStatus(...e))},"重置")]),h("div",S,[h("div",W,[h("div",null,[E,m(h("input",{"onUpdate:modelValue":e[4]||(e[4]=e=>a.r=e),type:"range",min:"-255",max:"255",onChange:e[5]||(e[5]=(...e)=>a.rgbaChange&&a.rgbaChange(...e))},null,544),[[p,a.r]]),h("span",H,v(a.r),1)]),h("div",null,[O,m(h("input",{"onUpdate:modelValue":e[6]||(e[6]=e=>a.g=e),type:"range",min:"-255",max:"255",onChange:e[7]||(e[7]=(...e)=>a.rgbaChange&&a.rgbaChange(...e))},null,544),[[p,a.g]]),h("span",R,v(a.g),1)]),h("div",null,[T,m(h("input",{"onUpdate:modelValue":e[8]||(e[8]=e=>a.b=e),type:"range",min:"-255",max:"255",onChange:e[9]||(e[9]=(...e)=>a.rgbaChange&&a.rgbaChange(...e))},null,544),[[p,a.b]]),h("span",_,v(a.b),1)]),h("div",null,[j,m(h("input",{"onUpdate:modelValue":e[10]||(e[10]=e=>a.a=e),type:"range",min:"-255",max:"255",onChange:e[11]||(e[11]=(...e)=>a.rgbaChange&&a.rgbaChange(...e))},null,544),[[p,a.a]]),h("span",A,v(a.a),1)])]),h("div",F,[h("div",null,[L,m(h("input",{"onUpdate:modelValue":e[12]||(e[12]=e=>a.h=e),type:"range",min:"-1",max:"1",step:"0.01",onChange:e[13]||(e[13]=(...e)=>a.hslChange&&a.hslChange(...e))},null,544),[[p,a.h]]),h("span",N,v(parseInt(100*a.h))+"%",1)]),h("div",null,[B,m(h("input",{"onUpdate:modelValue":e[14]||(e[14]=e=>a.s=e),type:"range",min:"-1",max:"1",step:"0.01",onChange:e[15]||(e[15]=(...e)=>a.hslChange&&a.hslChange(...e))},null,544),[[p,a.s]]),h("span",$,v(parseInt(100*a.s))+"%",1)]),h("div",null,[q,m(h("input",{"onUpdate:modelValue":e[16]||(e[16]=e=>a.l=e),type:"range",min:"-1",max:"1",step:"0.01",onChange:e[17]||(e[17]=(...e)=>a.hslChange&&a.hslChange(...e))},null,544),[[p,a.l]]),h("span",G,v(parseInt(100*a.l))+"%",1)])])]),h("div",z,[J,h("select",{onChange:e[18]||(e[18]=(...e)=>a.selectPreset&&a.selectPreset(...e)),id:"preset"},[(d(!0),c(f,null,C(a.preset.list,((e,t)=>(d(),c("option",{key:e,selected:t===a.preset.curIndex},v(e),9,["selected"])))),128))],32)]),h("div",K,[h("div",{class:"preview",ref:"refCanvasContainer",onMousewheel:e[22]||(e[22]=I((()=>{}),["prevent"]))},[h("div",{class:"canvas",style:{transform:`scale(${a.scale})`},onMousedown:e[19]||(e[19]=(...e)=>a.dragStart&&a.dragStart(...e)),onMousemove:e[20]||(e[20]=(...e)=>a.dragOver&&a.dragOver(...e)),onMouseup:e[21]||(e[21]=(...e)=>a.dragEnd&&a.dragEnd(...e))},[h("canvas",{ref:"refCanvas",width:a.canvas.width,height:a.canvas.height},null,8,["width","height"])],36)],544),h("div",Q,[h("div",{class:"origin",style:{"background-image":`url(${a.imageUrl})`},onClick:e[23]||(e[23]=(...e)=>a.showImage&&a.showImage(...e))},null,4),h("div",Z,[h("span",null,v(parseInt(100*a.scale))+"%",1),m(h("input",{"onUpdate:modelValue":e[24]||(e[24]=e=>a.scale=e),type:"range",min:"0.1",max:"1.9",step:"0.01"},null,512),[[p,a.scale]])])])])])),_:1}),m(h("div",{class:"preview-image",onClick:e[25]||(e[25]=e=>a.showPreviewImg=!1)},[h("img",{src:a.imageUrl},null,8,["src"])],512),[[w,a.showPreviewImg]])],64)}));X.render=aa,X.__scopeId="data-v-486cb5f6";export default X;
